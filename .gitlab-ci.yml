stages:
  - lint
  - test

variables:
  DOCKER_TLS_CERTDIR: "/certs"

services:
  - name: harbor.pg.innopolis.university/demo_docker_ci_blxxdclxud/docker:stable-dind
    alias: docker

linting:
  stage: lint
  before_script:
    - docker info
    - echo "$HARBOR_PASSWORD" | docker login -u "$HARBOR_USERNAME" "$HARBOR_HOST" --password-stdin
  services:
    - name: harbor.pg.innopolis.university/demo_docker_ci_blxxdclxud/golangci/golangci-lint
      alias: golangci-lint

  script:
    - golangci-lint run ./backend


testing:
  stage: test
  before_script:
    - docker info
    - echo "$HARBOR_PASSWORD" | docker login -u "$HARBOR_USERNAME" "$HARBOR_HOST" --password-stdin
  services:
    - name: harbor.pg.innopolis.university/demo_docker_ci_blxxdclxud/golang:1.21
      alias: go
  script:
    - go test -v ./backend/tests

