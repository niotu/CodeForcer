stages:
  - lint
  - test

image: docker:latest

variables:
  DOCKER_DRIVER: overlay2
  DOCKER_TLS_CERTDIR: ""

before_script:
  - echo "$DOCKER_PASSWORD" | docker login -u "$DOCKER_USERNAME" --password-stdin

cache:
  key: ${CI_COMMIT_REF_SLUG}
  paths:
    - /var/lib/docker

linting:
  stage: lint
  image: golangci/golangci-lint:v1.44
  services:
    - docker:dind
  script:
    - docker pull golangci/golangci-lint:v1.44 || true
    - golangci-lint run ./backend
  tags:
    - docker

testing:
  stage: test
  image: golang:1.21
  script:
    - go test -v ./backend/tests
  tags:
    - docker
