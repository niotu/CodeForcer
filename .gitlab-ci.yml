stages:
  - login
  - lint
  - test

image: docker:latest

variables:
  DOCKER_DRIVER: overlay2

log in:
  stage: login
  script:
    - echo "$DOCKER_PASSWORD" | docker login -u "$DOCKER_USERNAME" --password-stdin

services:
  - docker:dind

linting:       # This job runs in the build stage, which runs first.
  stage: lint
  image: golangci/golangci-lint:v1.44
  script:
    - golangci-lint run ./backend
  tags:
    - docker

testing:
  stage: test
  image: golang:1.21  # Using official Go Docker image
  script:
    - go test -v ./backend/tests  # Runs tests with verbose output for all packages
  tags:
    - docker
